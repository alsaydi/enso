


def main {
  hello_world("William");
}

def html(title) {
  <html>
    <head><title>$title</title></head>
    <body>yield</body>
  </html>
}

def hello_world(name) {
  html("Test") {
    <h1> "Hello World " $name </h1>
    navigate("Hello World!", hello_world("Tijs"));

    form() {
      <ul>
      for (x: root->classes, i) {
        <li>$i ": " edit(x->name);
	 <ul>
		for (y: x->fields, i) {
		    <li>edit(y->name);
			checkbox("Key", y->key);
			checkbox("Optional", y->optional);
			checkbox("Many", y->many);
			checkbox("Traversal", y->traversal);
		     </li>
		}			
	 </ul>
        </li>
      }
      </ul>

      submit("Submit", hello_world(name));
    }

 }
}

def navigate(title, page) {
  <a href=link(page)>$title</a>
}

def edit(data) {
  <input name=address(data) type="text" value=data/>
}


def select(data) {
  <select>
   for (x: elts) 
      <option name=x->name value=x->name/>
  </select>   
}

def checkbox(title, data) {
  <label>$title ": "</label>
  if (data) 
    <input name=address(data) type="checkbox" checked="true" value="true"/>
  else
    <input name=address(data) type="checkbox" value="true"/>
}

def form {
  <form action="/$submit" method="post">
    yield
  </form>
}

def submit(text, action) {
  let
    name = gensym
  in {
    <input type="hidden" name="redirect_" + name value=link(action)/>
    <input type="submit" name=name value=text /> 
  }
}