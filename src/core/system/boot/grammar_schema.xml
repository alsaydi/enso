<Schema>
  <types>
    <Primitive name='str'/>
    <Primitive name='int'/>
    <Primitive name='bool'/>
    <Primitive name='real'/>
    <Primitive name='atom'/>
    <Class name='Grammar'>
      <defined_fields>
        <Field name='start'>
          <type>
            /types[Rule]
          </type>
        </Field>
        <Field name='rules' optional='true' many='true' traversal='true'>
          <type>
            /types[Rule]
          </type>
          <inverse>
            /types[Rule]/defined_fields[grammar]
          </inverse>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Expression'>
      <subclasses>
        /types[Alt] /types[Sequence] /types[Create] /types[Field]
        /types[Code] /types[Value] /types[Ref] /types[Lit]
        /types[Call] /types[Regular] /types[Epsilon]
      </subclasses>
    </Class>
    <Class name='Rule'>
      <defined_fields>
        <Field name='name' key='true'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='grammar'>
          <type>
            /types[Grammar]
          </type>
          <inverse>
            /types[Grammar]/defined_fields[rules]
          </inverse>
        </Field>
        <Field name='arg' optional='true' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Alt'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='alts' many='true' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Sequence'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='elements' optional='true' many='true' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Create'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='arg' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Field'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='arg' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Code'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='code'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='expr' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Value'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='kind'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Ref'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='path' traversal='true'>
          <type>
            /types[Path]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Lit'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='value'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Call'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='rule'>
          <type>
            /types[Rule]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Regular'>
      <supers>
        /types[Expression]
      </supers>
      <defined_fields>
        <Field name='arg' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
        <Field name='optional'>
          <type>
            /types[bool]
          </type>
        </Field>
        <Field name='many'>
          <type>
            /types[bool]
          </type>
        </Field>
        <Field name='sep' optional='true' traversal='true'>
          <type>
            /types[Expression]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Epsilon'>
      <supers>
        /types[Expression]
      </supers>
    </Class>
    <Class name='Key'>
      <subclasses>
        /types[It] /types[Const] /types[Path]
      </subclasses>
    </Class>
    <Class name='It'>
      <supers>
        /types[Key]
      </supers>
    </Class>
    <Class name='Path'>
      <supers>
        /types[Key]
      </supers>
      <subclasses>
        /types[Anchor] /types[Sub]
      </subclasses>
    </Class>
    <Class name='Const'>
      <supers>
        /types[Key]
      </supers>
      <defined_fields>
        <Field name='value'>
          <type>
            /types[atom]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Anchor'>
      <supers>
        /types[Path]
      </supers>
      <defined_fields>
        <Field name='type'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Sub'>
      <supers>
        /types[Path]
      </supers>
      <defined_fields>
        <Field name='parent' optional='true' traversal='true'>
          <type>
            /types[Path]
          </type>
        </Field>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='key' optional='true' traversal='true'>
          <type>
            /types[Key]
          </type>
        </Field>
        <Field name='is_root'>
          <type>
            /types[bool]
          </type>
          <computed>
          	<ECode code='@parent == nil'/>
          </computed>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Command'>
      <subclasses>
        /types[Expr] /types[EWhile] /types[EFor] /types[EIf] /types[EBlock]
        /types[EFunCall] /types[EFunDef] /types[EAssign] /types[EImport]
      </subclasses>
    </Class>
    <Class name='EWhile'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='cond' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='body' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EFor'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='var'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='list' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='body' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EIf'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='cond' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='body' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
        <Field name='body2' optional='true' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EBlock'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='body' optional='true' many='true' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='ELambda'>
      <defined_fields>
        <Field name='body' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
        <Field name='formals' optional='true' many='true' traversal='true'>
          <type>
            /types[Formal]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EFunDef'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='formals' optional='true' many='true' traversal='true'>
          <type>
            /types[Formal]
          </type>
        </Field>
        <Field name='body' traversal='true'>
          <type>
            /types[Command]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Formal'>
      <defined_fields>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EAssign'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='var' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='val' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EImport'>
      <supers>
        /types[Command]
      </supers>
      <defined_fields>
        <Field name='path'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='Expr'>
      <supers>
        /types[Command]
      </supers>
      <subclasses>
        /types[EFunCall] /types[ETernOp] /types[EBinOp] /types[EUnOp]
        /types[EField] /types[EVar] /types[ESubscript] /types[EList]
        /types[EAddress] /types[ENew] /types[EConst]
      </subclasses>
    </Class>
    <Class name='ETernOp'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='op1'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='op2'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='e1' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='e2' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='e3' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EBinOp'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='op'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='e1' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='e2' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EUnOp'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='op'>
          <type>
            /types[str]
          </type>
        </Field>
        <Field name='e' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EFunCall'>
      <supers>
        /types[Expr] /types[Command]
      </supers>
      <defined_fields>
        <Field name='lambda' optional='true' traversal='true'>
          <type>
            /types[ELambda]
          </type>
        </Field>
        <Field name='fun' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='params' optional='true' many='true' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EField'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='e' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='fname'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EVar'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='name'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='ESubscript'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='e' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
        <Field name='sub' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EList'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='elems' optional='true' many='true' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EAddress'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='e' traversal='true'>
          <type>
            /types[Expr]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='ENew'>
      <supers>
        /types[Expr]
      </supers>
      <defined_fields>
        <Field name='class'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EConst'>
      <supers>
        /types[Expr]
      </supers>
      <subclasses>
        /types[EStrConst] /types[EIntConst] /types[EBoolConst]
        /types[ERealConst] /types[ENil]
      </subclasses>
    </Class>
    <Class name='EStrConst'>
      <supers>
        /types[EConst]
      </supers>
      <defined_fields>
        <Field name='val'>
          <type>
            /types[str]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EIntConst'>
      <supers>
        /types[EConst]
      </supers>
      <defined_fields>
        <Field name='val'>
          <type>
            /types[int]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='EBoolConst'>
      <supers>
        /types[EConst]
      </supers>
      <defined_fields>
        <Field name='val'>
          <type>
            /types[bool]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='ERealConst'>
      <supers>
        /types[EConst]
      </supers>
      <defined_fields>
        <Field name='val'>
          <type>
            /types[real]
          </type>
        </Field>
      </defined_fields>
    </Class>
    <Class name='ENil'>
      <supers>
        /types[EConst]
      </supers>
    </Class>
  </types>
</Schema>
