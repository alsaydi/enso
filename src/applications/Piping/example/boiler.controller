start IGNITE

WATER_MARGIN = 15
RADIATOR_MARGIN = 5

PUMP_SPEED = 10
MIN_GAS = 50
MAX_GAS = 150

BURNER_RAMPUP = 1

state IGNITE:
 if Burner.ignite goto RAMPUP
 Burner.ignite = true
 Burner.gas_level = MIN_GAS
 Pump.flow = 0.05
 Pump.run = true
 turn splitter Valve center

state RAMPUP:
 if Radiator.temperature > Radiator.user_temp and Boiler.temperature < Boiler.user_temp - WATER_MARGIN goto BOILER
 if Radiator.temperature < Radiator.user_temp - RADIATOR_MARGIN and Boiler.temperature > Boiler.user_temp goto RADIATOR
 if Radiator.temperature > Radiator.user_temp and Boiler.temperature > Boiler.user_temp goto RUNNING
 raise Burner.gas_level by BURNER_RAMPUP
 turn splitter Valve center

state BOILER:
 if Radiator.temperature < Radiator.user_temp goto RAMPUP
 if Boiler.temperature > Boiler.user_temp goto RUNNING
 turn splitter Valve left

state RADIATOR:
 if Boiler.temperature < Boiler.user_temp goto RAMPUP
 if Radiator.temperature > Radiator.user_temp goto RUNNING
 turn splitter Valve right

state COOLDOWN:
 if Radiator.temperature > Radiator.user_temp + RADIATOR_MARGIN and Boiler.temperature < Boiler.user_temp goto BOILER
 if Radiator.temperature < Radiator.user_temp and Boiler.temperature > Boiler.user_temp + WATER_MARGIN goto RADIATOR
 if Radiator.temperature < Radiator.user_temp + RADIATOR_MARGIN  and Boiler.temperature < Boiler.user_temp + WATER_MARGIN goto RUNNING
 lower Burner.gas_level by BURNER_RAMPUP
 turn splitter Valve center

state RUNNING:
 if Radiator.temperature < Radiator.user_temp - RADIATOR_MARGIN or Boiler.temperature < Boiler.user_temp - WATER_MARGIN goto RAMPUP
 if Radiator.temperature > Radiator.user_temp + RADIATOR_MARGIN or Boiler.temperature > Boiler.user_temp + WATER_MARGIN goto COOLDOWN
