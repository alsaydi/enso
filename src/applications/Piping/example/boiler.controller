start OFF

DESIRED_WATER_TEMP = 100
WATER_MARGIN = 10
DESIRED_RADIATOR_TEMP = 100
RADIATOR_MARGIN = 10

PUMP_SPEED = 10
MIN_GAS = 50
MAX_GAS = 150

BURNER_RAMPUP = 5
VALVE_SWITCH = 5

state OFF:
 if Radiator.temperature < DESIRED_RADIATOR_TEMP - RADIATOR_MARGIN goto IGNITE
 if Boiler.temperature < DESIRED_WATER_TEMP - WATER_MARGIN goto IGNITE

state IGNITE:
 if Burner.ignite goto RAMPUP
 Burner.ignite = true
 gas = MIN_GAS
 Burner.gas_level = gas
 Pump.run = true

state RAMPUP:
 if Radiator.temperature > DESIRED_RADIATOR_TEMP and Boiler.temperature < DESIRED_WATER_TEMP - WATER_MARGIN goto BOILER
 if Radiator.temperature < DESIRED_RADIATOR_TEMP - RADIATOR_MARGIN and Boiler.temperature > DESIRED_WATER_TEMP goto RADIATOR
 if Radiator.temperature > DESIRED_RADIATOR_TEMP and Boiler.temperature > DESIRED_WATER_TEMP goto RUNNING
 Burner.ignite = true
 gas = gas + BURNER_RAMPUP
 Burner.gas_level = gas
 Pump.run = true

state BOILER:
 if Radiator.temperature < DESIRED_RADIATOR_TEMP - RADIATOR_MARGIN goto RAMPUP
 if Boiler.temperature > DESIRED_WATER_TEMP + WATER_MARGIN goto COOLDOWN
 turn splitter Valve left by 10

state RADIATOR:
 if Boiler.temperature < DESIRED_WATER_TEMP - WATER_MARGIN goto RAMPUP
 if Radiator.temperature > DESIRED_RADIATOR_TEMP + RADIATOR_MARGIN goto COOLDOWN
 turn splitter Valve left by -10

state COOLDOWN:
 if Radiator.temperature > DESIRED_RADIATOR_TEMP + RADIATOR_MARGIN and Boiler.temperature < DESIRED_WATER_TEMP goto BOILER
 if Radiator.temperature < DESIRED_RADIATOR_TEMP and Boiler.temperature > DESIRED_WATER_TEMP + WATER_MARGIN goto RADIATOR
 if Radiator.temperature < DESIRED_RADIATOR_TEMP and Boiler.temperature < DESIRED_WATER_TEMP goto RUNNING
 gas = gas - BURNER_RAMPUP
 Burner.gas_level = gas

state RUNNING:
 if Radiator.temperature < DESIRED_RADIATOR_TEMP - RADIATOR_MARGIN or Boiler.temperature < DESIRED_WATER_TEMP - WATER_MARGIN goto RAMPUP
 if Radiator.temperature > DESIRED_RADIATOR_TEMP - RADIATOR_MARGIN or Boiler.temperature > DESIRED_WATER_TEMP - WATER_MARGIN goto RAMPUP
