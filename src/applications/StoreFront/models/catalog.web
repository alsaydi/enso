


def index_products(cat) {
  site("") {
    <div class="favorite">
      pers_favorites();
    </div>
    <ul>
      for (product: cat->products) {
        <li>product_summary(product);</li>
      }
    </ul>
  }
}

def show_product(product) {
  site("") {
    <div id="product-details">
      product_display(product)
    </div>
  }
}

def category_list() {
  <ul class="category-list">
    for (parent: root->categories) {
      <li>
      <h3>$parent->name;</h3>
      <ul>
        for (child: parent->sub_categories) {
           <li>navigate(child->name, index_products(child))</li>
        }
      </ul>
    }
  </ul>
}

def product_summary(product) {
  product_display(product, false, false);
}

def product_display(product, show_description, show_add_to_cart) {
  <div class="prod-wrap">
    <div class="prod-img">
      img_navigate("/static/product_images/" + product->default_image_path, 
          "Show details of " + product->name, show_product(product));
    </div>
    <div class="prod-info">
      <h3>navigate_tip(product->name,  "Show details of " + product->name, show_product(product));</h3>
      if (show_description) {
        $product->description
      }
      <div class="price"><label>Price:</label> $product->price</div>
      if (show_add_to_cart) {
        form {
          <div class="add-to-bag">
          add("Add Item To Cart >>>", product, user->cart, self);
          </div>
        }
      }
      if (user->is_admin) {
        navigate("Manage", edit_product(product));
      }
    </div>
  </div>
}

